@model Airways.ViewModels.FlightCustomizeVM

<div class="card">
    <div class="card-header bg-dark text-white">
        <h5 class="mb-0">Flight Details</h5>
    </div>
    <div class="card-body">
        <div id="cartMessage" class="alert alert-success" style="display: none;">
            Flight added to your cart successfully!
        </div>

        <div class="row mb-3">
            <div class="col-12">
                <h6>Flight #@Model.FlightNumber</h6>
                <p class="mb-1">
                    <strong>From:</strong> @Model.DepartureCity <span class="text-muted">(@Model.DepartureTime.ToString("HH:mm"))</span>
                </p>
                <p class="mb-1">
                    <strong>To:</strong> @Model.ArrivalCity <span class="text-muted">(@Model.ArrivalTime.ToString("HH:mm"))</span>
                </p>
                <p class="mb-1">
                    <strong>Date:</strong> @Model.TravelDate.ToString("yyyy-MM-dd")
                </p>
            </div>
        </div>

        @if (!Model.HasAvailableEconomySeats && !Model.HasAvailableBusinessSeats)
        {
            <div class="alert alert-warning">
                <strong>Sorry!</strong> This flight has no seats left in any class.
            </div>
        }
        else
        {
            <form id="addToCartForm">
                <!-- Hidden fields for flight information -->
                <input type="hidden" name="FlightId" value="@Model.FlightId" />
                <input type="hidden" name="TravelDate" value="@Model.TravelDate.ToString("yyyy-MM-dd")" />
                <input type="hidden" name="DepartureCity" value="@Model.DepartureCity" />
                <input type="hidden" name="ArrivalCity" value="@Model.ArrivalCity" />
                <input type="hidden" name="DepartureTime" value="@Model.DepartureTime.ToString("HH:mm")" />
                <input type="hidden" name="ArrivalTime" value="@Model.ArrivalTime.ToString("HH:mm")" />
                <input type="hidden" id="totalPriceInput" name="TotalPrice" value="@Model.PriceEconomy" />

                <div class="row mb-3">
                    <div class="col-12">
                        <h6>Class Selection</h6>
                        @if (Model.HasAvailableEconomySeats)
                        {
                            <div class="form-check mb-2">
                                <input class="form-check-input class-selection" type="radio" name="TravelClass" id="economyClass" value="Economy" checked
                                       data-price="@Model.PriceEconomy" onchange="updateTotalPrice()">
                                <label class="form-check-label" for="economyClass">
                                    Economy Class - @Model.PriceEconomy.ToString("C")
                                </label>
                            </div>
                        }
                        else
                        {
                            <div class="text-danger mb-2">
                                <small>Economy Class - No seats left</small>
                            </div>
                        }

                        @if (Model.HasAvailableBusinessSeats)
                        {
                            <div class="form-check">
                                <input class="form-check-input class-selection" type="radio" name="TravelClass" id="businessClass" value="Business"
                                @(!Model.HasAvailableEconomySeats ? "checked" : "")
                                       data-price="@Model.PriceBusiness" onchange="updateTotalPrice()">
                                <label class="form-check-label" for="businessClass">
                                    Business Class - @Model.PriceBusiness.ToString("C")
                                </label>
                            </div>
                        }
                        else
                        {
                            <div class="text-danger">
                                <small>Business Class - No seats left</small>
                            </div>
                        }
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-12">
                        <h6>Meal Selection</h6>
                        <p><small>All meals cost an additional €35.00</small></p>

                        <div class="form-group">
                            <select class="form-control" id="mealSelection" name="MealId" onchange="updateTotalPrice()">
                                <option value="">-- No meal --</option>
                                @foreach (var meal in Model.Meals)
                                {
                                    <option value="@meal.MealId">
                                        @meal.Name @(meal.IsLocalMeal == true ? "(Local specialty)" : "")
                                    </option>
                                }
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-12">
                        <h6>Total Price: <span id="displayTotalPrice">@Model.PriceEconomy.ToString("C")</span></h6>
                    </div>
                </div>

                <div class="row mt-4">
                    <div class="col-12">
                        <button type="button" id="addToCartButton" class="btn btn-primary">
                            Add to Cart
                        </button>
                    </div>
                </div>
            </form>
        }
    </div>
</div>

<script>
    

    $(document).ready(function () {
        $('#addToCartButton').click(function () {
            var formData = $('#addToCartForm').serialize();

            $.ajax({
                url: '@Url.Action("AddToCart", "Search")',
                type: 'POST',
                data: formData,
                success: function (response) {
                    if (response.success) {
                        $('#cartMessage').text(response.message).show();
                        setTimeout(function () {
                            $('#cartMessage').fadeOut();
                        }, 3000);
                    } else {
                        alert('Error: ' + response.message);
                    }
                },
                error: function () {
                    alert('An error occurred while processing your request.');
                }
            });
        });
    });
</script>